---
phase: 03-manual-entry-system
plan: 01
type: execute
---

<objective>
Create account management system with API endpoints and UI for managing bank accounts, credit cards, and cash wallets.

Purpose: Users need to define their financial accounts before logging transactions. This is the foundation for all expense tracking.
Output: Working accounts CRUD with list view and add/edit functionality.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-data-models/02-01-SUMMARY.md

@lib/db.ts
@lib/migrations/001_core_schema.sql
@components/ui/button.tsx
@components/ui/input.tsx
@components/ui/card.tsx

**Tech stack available:**
- Next.js 16 with App Router
- better-sqlite3 (synchronous API)
- Shadcn UI (button, input, card installed)
- Tailwind CSS v4

**Established patterns:**
- Money amounts: INTEGER in paise (100.50 INR = 10050)
- Booleans: INTEGER with 1=true, 0=false
- Database: Direct better-sqlite3 calls from API routes

**Constraining decisions:**
- Phase 1-02: better-sqlite3 for database (synchronous API)
- Phase 2-01: Accounts table with type, currency, balance fields
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create accounts API endpoints</name>
  <files>app/api/accounts/route.ts, app/api/accounts/[id]/route.ts</files>
  <action>
Create REST API for accounts:

**GET /api/accounts** - List all accounts
- Return array of accounts ordered by name
- Include computed display balance (paise to rupees formatting done client-side)

**POST /api/accounts** - Create account
- Accept: { name, type, currency?, balance? }
- Validate: name required, type in ['bank', 'credit_card', 'cash', 'other']
- Default balance to 0 if not provided
- Convert balance from rupees to paise before storing
- Return created account with 201 status

**GET /api/accounts/[id]** - Get single account
- Return 404 if not found

**PUT /api/accounts/[id]** - Update account
- Accept partial updates
- Return updated account

**DELETE /api/accounts/[id]** - Delete account
- Return 204 on success
- Handle foreign key constraint errors gracefully (transactions exist)

Use db.prepare() with named parameters to prevent SQL injection. Return JSON with proper status codes.
  </action>
  <verify>
curl http://localhost:3000/api/accounts returns 200 with empty array
curl -X POST http://localhost:3000/api/accounts -H "Content-Type: application/json" -d '{"name":"Test Bank","type":"bank"}' returns 201
  </verify>
  <done>All 5 endpoints work: list, create, get, update, delete. Proper error handling for validation and not-found cases.</done>
</task>

<task type="auto">
  <name>Task 2: Create accounts management UI</name>
  <files>app/accounts/page.tsx, components/accounts/account-form.tsx, components/accounts/account-list.tsx</files>
  <action>
Create accounts management page at /accounts:

**Account List Component (account-list.tsx):**
- Fetch accounts from API on mount
- Display as cards showing: name, type badge, balance (formatted as Rs. X,XXX.XX)
- Edit and Delete buttons per account
- Empty state when no accounts

**Account Form Component (account-form.tsx):**
- Controlled form with: name (text), type (select), initial balance (number)
- Type options: Bank Account, Credit Card, Cash, Other
- Balance input in rupees (convert to paise on submit)
- Submit creates via POST, edit mode uses PUT
- Form validation: name required, type required
- Close/cancel functionality

**Accounts Page (page.tsx):**
- "Add Account" button opens form modal/dialog
- Account list below
- Edit button opens form in edit mode
- Delete with confirmation

Use Shadcn components. Style with dark theme (bg-neutral-900, text-neutral-100). Mobile-responsive layout.

Note: For select dropdown, use a simple HTML select styled with Tailwind for now (Shadcn Select requires additional install). Keep it simple.
  </action>
  <verify>npm run build succeeds without TypeScript errors</verify>
  <done>Accounts page renders at /accounts, shows account list, add/edit/delete all functional via UI.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Account management system with API and UI</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/accounts
    3. Test: Click "Add Account", fill form, submit
    4. Verify: New account appears in list with correct balance
    5. Test: Click edit on an account, modify name, save
    6. Verify: Name updates in list
    7. Test: Click delete, confirm
    8. Verify: Account removed from list
    9. Check: Mobile responsive (resize browser)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All API endpoints return correct status codes
- [ ] TypeScript compilation passes (npm run build)
- [ ] Accounts page accessible at /accounts
- [ ] CRUD operations work end-to-end
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Account management fully functional
</success_criteria>

<output>
After completion, create `.planning/phases/03-manual-entry-system/03-01-SUMMARY.md` following summary template.
</output>
